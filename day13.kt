import kotlinPuzzleLibrary.*

fun main() {
    var input =
"""
                                                     /------------------------------------------------------\                  /---------------\
  /--------------------------------------------------+--------------------------------------------------\   |                  |               |
  |                                  /---------------+----------------------------------\               |   |                  |               |
  |                  /---------------+---------\     |                                  |               |   |                  |               |
  |                  |               |         |     |       /--------------------------+---------------+---+--------------\   |               |
  |                  |  /------------+---------+-----+-------+-\/-----------------------+--\            |   |              |   |               |
  |   /--------\     |  |            |         |     |       | ||                 /-----+--+------------+---+----\         |   |               |
  |   |        |     |  |            |         |     |       | ||             /---+-----+--+------------+---+----+-\       |   |               |
  |   |        |     |  |            |         |/----+-------+-++-------------+---+-----+--+------------+---+----+-+-\     |   |               |
  |   |        |     |  |         /--+---------++----+-------+-++-------------+---+-----+--+------------+---+\   | | |     |   |               |
  | /-+--------+-----+--+---------+--+----\    ||    | /-----+-++-------------+---+-----+--+-\          |   ||   | | |     |   |   /-----------+-\
  | | |        |     |  |         |  |    |    ||    | |   /-+-++-------------+---+-----+--+-+----------+---++---+-+-+-----+---+---+---------\ | |
  | | |        | /---+--+---------+--+----+----++----+-+---+\| ||             |   |     |  | |          |   ||   | | |     |   |   |         | | |
  | | |        | |   |  |    /----+--+----+----++----+-+---+++-++-------------+---+-----+--+-+----------+---++---+-+-+----\|   \---+---------+-/ |
  | | |        | |   |  |    |   /+--+----+----++----+\|   ||| ||      /------+---+-----+--+-+----------+---++---+-+-+----++-------+--\      |   |
  | | |        | |   |  |    |  /++--+----+----++----+++---+++-++------+------+---+-----+--+\|          |   ||   | | |    ||       |  |      |   ^
  | | |    /---+-+---+--+\   |  |||  |    |    ||    |||   ||| ||      |    /-+---+-----+--+++-----\    |   ||   | | |    ||       |  |      |   |
  | | |    |   | |   |  ||   |  |||  |    |    ||    |||   ||| ||      |    | |   |   /-+--+++-----+----+---++---+-+\|    ||       |  |      |   |
  | | |    |   | |   |  || /-+--+++--+----+----++----+++---+++-++------+----+-+---+---+-+--+++-----+----+---++--\| |||    ||       | /+------+---+---\
  | | |    |   | |  /+--++-+-+--+++--+----+----++--\ |||   ||| ||/-----+----+-+---+--\| |  |||     |    |   ||  || |||   /++-------+-++-----\|   |   |
  | | |    |   | |  ||  || | |  |||  |    |    ||  | |||   ||| |\+-----+----+-+---+--++-+--/||     |    |  /++--++-+++---+++-------+-++----\||   |   |
  | | |    |   | |  || /++-+-+--+++--+----+----++--+-+++---+++\| |     |    | |   |  || |   ||     |    |  |||  || |||   |||       | ||    |||   |   |
  | | |    |   | |  || ||| | |  |||  |    |    ||  | |||   ||||| |     |   /+-+---+--++-+---++-----+----+--+++--++-+++---+++-------+-++----+++--\|   |
  | | |    |   | |  || ||| | |  |||  |    |  /-++--+-+++---+++++-+-----+---++-+---+--++-+---++-----+----+--+++--++-+++--\|||       | ||    |||  ||   |
  | | |    |   | |  || ||| | |  |||  |   /+--+-++--+-+++\  ||||| |     |   || |   | /++-+---++-----+----+--+++--++-+++--++++-------+-++----+++--++\  |
  | | |  /-+---+-+--++-+++-+\|  |||  |   ||  | ||  | ||||  ||||| |     |   || |   | ||| |   ||     |    |  |||  || |||  ||||       | ||    |||  |||  |
  | | |  | |   | |  || ||| |||  |||  |   ||  | ||  | ||||  ||||| |     |   || |   | ||| |   ||     |    |  |||  || |||  ||||   /---+-++--\ |||  |||  |
  | | |  | |   | |/-++-+++-+++-\|||  |   ||  | ||/-+-++++--+++++-+-----+---++-+---+-+++-+---++-----+----+--+++--++-+++\ ||||   |   | ||  | |||  |||  |
  | | |  | |   | || || ||| ||| ||||  |/--++--+-+++-+-++++--+++++-+-----+---++-+---+-+++-+---++-----+--\ |  |||  || |||| ||||   |   | ||  | |||  |||  |
  | | |  | |   | || || ||| ||| ||||  ||  ||  | ||| | ||\+--+++++-+-----+---++-+---+-+++-+---+/     |  | |  |||  || |||| ||v|   |   | ||  | |||  |||  |
  | | |  | | /-+-++-++-+++-+++-++++--++--++--+-+++-+-++-+--+++++-+-----+---++-+---+-+++-+---+---\  |  | |  |||  || |||| |\++---+---+-++--+-+/|  |||  |
  | | | /+-+-+-+-++-++-+++-+++-++++--++--++--+-+++-+-++-+--+++++-+-----+---++-+---+-+++-+---+---+--+--+\|  |||  || ||||/+-++---+---+-++\ | | |  |||  |
  | |/+-++-+-+-+-++-++-+++-+++-++++--++--++--+-+++-+-++-+--+++++-+-----+\  || |  /+-+++-+---+---+--+--+++--+++--++-++++++-++---+---+-+++-+-+-+-\|||  |
  | ||| || | | |/++-++-+++-+++-++++--++--++--+-+++-+-++-+--+++++-+-----++--++-+--++-+++-+---+---+--+-\|||  |||  || |||||| ||   |   | ||| | | | ||||  |
  | ||| || | | |||| || ||| ||| |||| /++--++--+-+++-+-++-+\ ||||| | /---++--++-+--++-+++-+---+---+--+-++++--+++--++-++++++\||   |   | ||| | | | ||||  |
  | ||| || | | |||| ||/+++-+++-++++-+++--++--+-+++-+\|| || ||||| | |   ||  || |  || ||| |   |   |  | ||||  |||  || |||||||||   |   | ||| | | | ||||  |
  | ||| || | | |||| |||||| ||| |||| |||  ||  | ||| |||| ||/+++++-+-+---++--++-+--++-+++-+---+---+--+-++++--+++--++-+++++++++---+---+-+++-+-+-+-++++\ |
  | ||| || | | |||\-++++++-+++-/||| |||  ||  | ||| |||| |||||||| |/+---++--++-+--++-+++-+---+---+--+-++++--+++-\|| |||||||||   |   | ||| | | | ||||| |
  | ||| || | | |||  |||||| |||  ||| |||  ||  | ||| |||| |||||||| |||   ||  || |  || ||| |   |   | /+-++++--+++-+++-+++++++++---+---+-+++-+-+-+\||||| |
  | ||| || | \-+++--++++++-+++--+++-+++--++--+-+++-++++-++++++++-+++---++--++-+--++-+++-+---+---/ || ||||  ||| ||| |||||||||   |   | ||| | | ||||||| |
  | ||| || |   |||  |||||| |||  ||| ||| /++--+-+++-++++-++++++++-+++---++--++-+--++-+++-+---+-----++-++++--+++\||| |||||||||   |   | ||| | | ||||||| |
  | ||| || |   |||  ||||\+-+++--+++-+++-+++--+-+++-++++-+++++++/ |||   ||  || |  || ||| |   |     || ||||  ||||||| |||||||||   |   | ||| | | ||||||| |
  | ||| || |   ||\--++++-+-+++--+++-+++-+++--+-+++-++++-++++/||  |||   ||  || |  || ||| |   | /---++-++++--+++++++-+++++++++--\|   | ||| | | ||||||| |
  | ||| || |   ||   |||| | |||  ||| ||| |\+--+-+++-++++-/||| ||  |||   ||  || |  || \++-+---+-+---++-++++--+++++++-+++++++++--++---+-+++-+-+-+++++/| |
  | ||| || |   ||   |||| | |||  ||| ||| | |  | ||| ||||  ||| ||  |||   ||  || |  ||  || |   | |   ||/++++--+++++++-+++++++++--++--\| ||| | | ||||| | |
  | ||| || |   ||   |||| | |||  ||| ||| | |  | ||| ||||  ||| ||  |||   ||  || |  ||  |v |   | |   |||||||  ||||||| |||||||||  ||  || ||| | | ||||| | |
/-+-+++-++-+---++---++++-+-+++--+++-+++-+-+--+-+++-++++--+++-++--+++---++--++-+--++--++-+---+-+-\ |||||||  ||||||| |||||||||  ||  || ||| | | ||||| | |
| | ||| || \---++---++++-//+++--+++-+++-+-+--+-+++-++++-\||| ||  \++---++--++-+--++--/| |   | | | |||||||  ||||||| |||||||||  ||  || ||| | | ||||| | |
| | ||| ||     ||   ||||  ||||  ||| ||| | |  | ||| |||| |||| ||   ||   ||  |\-+--++---+-+---+-+-+-+/|||||  ||||||| |||||||||  ||  || ||| | | ||||| | |
| | ||| ||     ||   ||||  ||||  ||| ||| | |  | ||| |||| |||| ||   ||   ||  |  ^  ||   | | /-+-+-+-+-+++++--+++++++-+++++++++--++--++-+++-+-+-+++++\| |
| | ||| ||     ||   ||||  ||||/-+++-+++-+-+--+-+++-++++-++++-++---++---++--+--+--++--\| |/+-+-+-+-+\|||||  ||||||| |||||||||  ||  || ||| | | ||||||| |
| | ||| ||     || /-++++--+++++-+++-+++-+-+--+\||| |||| |||| ||   ||   ||  |  |  ||  || ||| | \-+-+++++++--+++++++-+++++++++--/|  || ||| | | ||||||| |
| | ||| ||     || | ||||  ||||| ||| ||| | |  ||||| |||| |||| ||   ||   ||  | /+--++--++-+++-+---+-+++++++--+++++++-+++++++++---+--++\||| | | ||||||| |
|/+-+++-++-----++-+-++++--+++++-+++-+++-+-+--+++++-++++-++++-++---++--\||  | ||  ||  || ||| |   | |||||||  ||||||| |||||||||   |  |||||| | | ||||||| |
||| ||| ||     || | ||||  ||||| ||| ||| | |  ||||| |||| |||| ||   ||/-+++--+-++--++--++-+++-+---+-+++++++--+++++++-+++++++++---+-\|||||| | | ||||||| |
||| ||| || /---++-+-++++--+++++-+++-+++\| |  ||||| |||| |||| ||   ||| |||  | ||  ||  || ||| |   | |||||||  ||||||| |||||||||   | ||||||| | | ||||||| |
||| ||| |\-+---++-+-++++--++/|| ||| ||||| |  |||\+-++++-++++-++---+++-+++--+-++--++--++-+++-+---+-+++++++--+++++++-++/||||||   | ||||||| | | ||||||| |
||| ||| |  |   || | ||||  || || ||| ||||| |  ||| | |||| |||| || /-+++-+++--+-++--++--++-+++-+---+-+++++++--+++++++\|| ||||||   | ||||||| | | ||||||| |
||| ||| |  |   || | ||||  || || ||\-+++++-+--+++-+-++++-++++-++-+-+++-+++--+-++--++--++-+++-+-<-+-+++++++--++/||||||| ||||||   | ||||\++-+-+-+++++++-/
||| ||| |  |   || | ||||  || || ||  ||||| |  ||| | |||| |||| || | ||| |||/-+-++--++--++-+++\|   | |||||||  || ||||||| ||||||   | |||| || | | |||||||
||| ||| |  |  /++-+-++++--++-++-++--+++++-+--+++-+-++++-++++-++-+-+++-++++-+-++--++\ || |||||   | |||||||  || ||||||| ||||||   | |||| || | | |||||||
||| ||| |  |  ||| | ||||  || || ||  ||||| |  ||| | |||| |||| || | ||| |||| | ||  ||| || |||||   | ||||||| /++-+++++++-++++++---+-++++-++-+-+-+++++++-\
||| ||\-+--+--+/| | ||||  || || ||  ||||| |  ||| | |||| |||| || | ||| |||| | ||  ||| || |||||   | ||||||| ||| ||||||| ||||||   | ||\+-++-+-+-++++/|| |
||| ||  |  |  | | \-++++--++-++-++--+++++-+--+/| | |||| |||| || | ||| |||| | ||  ||| || |||||   | ||||||| ||| ||||||| ||||||   | || | || | | |||| || |
||| ||  |  |  | |   ||||  || || ||  ||||| |  | | | |||| |||| || | ||| |||| | \+--+++-++-+++++---+-+++++++-+++-+++++++-++++++---+-++-/ || | | |||| || |
||v \+--+--+--+-+---++++--++-++-++--+++++-/  | | | |||| |||| || | ||| |||| |  |  \++-++-+++++---+<+++++++-+++-+++++++-++++++---+-++---++-+-+-++/| || |
|||  \--+--+--+-+---++++--++-++-++--+++++----+-+-+-++++-++++-++-+-+++-++/| |  |   || || |||||   | ||||||| ||| ||||||| ||||||   | ||   || | | || | || |
|||     |  |  | |   ||||  || || ||  |||||    | | | |||| |||| || | ||| || | |  |/--++-++-+++++---+-+++++++-+++-+++++++-++++++---+-++\  || | | || | || |
|||     |  |  | |   ||||  || || ||  |||||    | | | |||| |||| || | ||| || | |  \+--++-++-+++++---+-+++++++-+++-+++++/| ||||||   | |||  || | | || | || |
|||     |  |  | |   ||||  || || ||  |||||    | | | |||| |||| || \-+++-++-+-+---+--++-++-+++++---+-+++++++-+++-++++/ | ||||||   | |||  || | | || | || |
|||     |  | /+-+---++++--++-++-++--+++++----+-+-+\|||| |||| ||   ||| || | |   |  || || |||||   | ||||||| ||| ||||  | ||||||   | |||  || | | || | || |
||| /---+--+-++-+---++++--++-++\||  |||||    | | |||||| |||| || /-+++-++-+-+\  |  || || |||||  /+-+++++++-+++-++++-\| ||||||   | |||  || | | || | || |
||| |   |  | || |   ||||  || |||||  |||||    | | |||||| |||| || | ||| || | ||  |  || |\-+++++--++-+++++++-+++-++++-+/ ||||||   | |||  || | | || | || |
||| |   |  | || |   ||||  |\-+++++--+++++----+-+-++++++-++++-++-+-+++-++-+-++--+--++-+--+++++--++-+++++++-+++-++/| |  ||||||   | |||  || | | || | || |
||| |   |  | || |   ||||  |  |||||/-+++++----+-+\|||||| |||| || | ||| || | ||  |  || |  |||||  ||/+++++++-+++-++-+-+--++++++---+-+++--++-+\| || | || |
||| |   | /+-++-+---++++--+--++++++-+++++----+-++++++++\|||\-++-+-+++-++-+-++--+--++-+--+++++--++++++++++-+++-++-+-+--++++++---+-+++--++-+++-/| | || |
||| |   | || || |   ||||  |  |||||| |||||/---+-++++++++++++--++\| |||/++-+-++--+--++-+--+++++--++++++++++-+++-++-+-+--++++++---+-+++--++\|||  | | || |
||| |   | || || |   ||||  |  |||||| ||||||   | ||||||||||||  |||| |||||| | ||  |  || |  |\+++--++++/||||| ||| ||/+-+--++++++\  | |||  ||||||  | | || |
||| |   | || || |   ||||  |  |||||| ||||||   | ||||||||||||  |||| |||||| | ||  |  || |  | |||  |||| |||||/+++-++++-+--+++++++--+-+++--++++++--+-+\|| |
||| |   | || || |   ||||  |  |||||| ||||||   | ||||||||||||  |||| |||||| | ||  |  || |  | |||  |||| ||||||||| |||| |  |||||||  | |||  ||||||  | |||| |
||| |   | || \+-+---++++--+--++++++-++++++---+-+++/||||||||  |||| |||||| | ||  |  || |  | |||  \+++-+++++++++-++++-/  |||||||  | |||  ||||||  | |||| |
||| |   | ||  | |   ||||  |  |||||| ||||||   | ||| ||||||||  |||| |||||| | ||  |  \+-+--+-+++---+++-+++++++++-+++/  /-+++++++--+-+++--++++++--+-++++\|
||| |   | ||  | |   ||||  |  |||||| ||||||   | ||| ||||||||  |||| |||||| | ||  |   | |  | |||   ||| ||||||||| |||   | |||||||  | |||  ||||||  | ||||||
||| |   | ||  | |   ||||  |  |||||| ||||||   | ||| ||||||||  |||| |||||| | ||  |   | |  | |||   ||| |||||||\+-+++---+-+++++++--+-+++--+++++/  | ||||||
||| |   | ||  | |   ||||  |  |||||| ||||||   | ||\-++++++++--++++-++++++-+-++--+---+-+--+-+++---+++-+++++++-+-+++---+-/||||||  | |||  |||||   | ||||||
||| |   | ||  | |   ||||  |  |||||| ||||||   | ||  ||||||||  |||| |||||| | ||  |   | |  | ||| /-+++-+++++++-+-+++---+--++++++--+-+++-\|||||   | ||||||
||| |   | ||  | |   ||||  |  |||||| |\++++---+-++--++++++++--++++-++++++-+-++--+---+-+--/ ||| | ||| ||||||| | |||   |  ||^|||  | ||| ||||||   | ||||||
||| |   | ||  | |   ||||  \--++++++-+-++++---+-++--+++++/||  |||| |||||| | ||  |   | |    ||| | ||| \++++++-+-+++---+--++++++--+-+/| ||||||   | ||||||
||| |   | ||  | |/--++++-----++++++-+-++++\  | ||  ||||| ||  |||| |||||| | ||  |   | |    ||| | |||  |||||| | |||   |  ||||||  | | | ||||||   | ||||||
||| |   | ||  | ||  ||||     |||||| | |||||  | ||  ||||| ||  |||| |||||| | ||  |   | |    ||| | |||  |||||| | |||   |  ||||||  | | | ||||||   | ||||||
||| |  /+-++--+-++--++++-----++++++-+-+++++--+-++--+++++-++--++++-++++++-+-++--+---+-+\   ||| | |||  |||||| | |||   |  ||||||  | | | ||||||   | ||||||
||| |  || ||  | \+--++++-----++++++-+-+++++--+-++--+++++-++--++++-++++++-+-++--+---+-++---+++-+-+++--/||||| | |||   |  ||||||  | | | ||||||   | ||||||
||| |  || ||  |  |  ||||     |||||| | |||||  | ||  ||||| || /++++-++++++-+-++--+---+-++---+++\| |||   ||||| | |||   |  ||||||  | | | ||||||   | ||||||
||| |  || ||  |  | /++++-----++++++-+-+++++--+-++--+++++-++-+++++-++++++-+-++--+---+-++---+++++-+++--\||||| | ||v   |  ||||||  | | | ||||||   | ||||||
||| |  || ||  |  | |||||     |||||| | |||||  | ||  ||||| || ||||| |||||| | \+--+---+-++---+++++-+++--++++++-+-+++---+--++++++--+-+-+-++++++---+-/|||||
||| |  || ||  |  | |||||     |||||| | |||||  | ||  ||||| |\-+++++-++++++-+--+--+---+-++---+++++-+++--++++++-+-+++---+--++++++--+-+-+-++++++---+--++/||
||| |  || ||  |  | |||||     |||||| | |||||  | ||  ||||| |  ||||| |||||\-+--+--+---+-++---+++++-+++--++++++-+-+++---+--++++++--+-+-+-+/||||   |  || ||
||| |  || ||/-+--+-+++++----\|||||| | |||||  | ||  ||||| |  ||||| |\+++--+--+--+---+-++---+++++-+++--++++++-+-+++---+--++/|||  | | | | ||||   |  || ||
||| | /++-+++-+--+-+++++----+++++++-+-+++++--+-++--+++++-+--+++++-+-+++--+--+--+---+-++---+++++-+++-\|||||| | |||   |  || |||  | | | | ||||   |  || ||
||| | |\+-+++-+--+-+++++----+++++++-+-+++++--+-++--+++++-+--+++++-+-+++--+--+--+---+-+/   ||||| ||| ||||||| |/+++---+--++-+++--+-+-+-+-++++-\ |  || ||
||| | | | ||| |  | |\+++----+++++++-+-+++++--+-++--/|||| |  ||||| | |||  |  |  |   | |    ||||| ||| ||||||| |||||   |  || |||  | | | | |||| | |  || ||
||\-+-+-+-+++-+--+-+-+++----+++++++-+-+++++--+-++---++++-+--+++++-+-+++--+--+--+>--+-+----+++++-+++-++++/|| |||||   |  || |||  | | | | |||| | |  || ||
||  | | | ||| |  | | |||    ||||||| | |||||  | ||   |||| |  ||||| | |||  |  |/-+---+-+----+++++-+++-++++-++-+++++---+--++-+++--+-+-+-+-++++-+-+-\|| ||
|| /+-+-+-+++-+--+-+-+++----+++++++-+-+++++--+-++---++++-+-\|\+++-+-+++--+--++-+---+-+----+++++-+++-++++-++-+++++---+--++-+/|  | | | | |||| | | ||| ||
|| || | \-+++-+--+-+-+++----+++++++-+-+++++--+-++---++++-+-++-+++-+-+++--+--++-+---+-+----+++++-+++-+++/ || |||||   |  || | |  | | | | |||| | | ||| ||
|| || |   ||| |  | | \++----+++++++-+-+++++--+-/|   |\++-+-++-+++-+-+++--+--++-+---+-+----+++++-+++-+++--++-/||||   |  |^ | |  | | | | |||| | | ||| ||
|| ||/+---+++-+--+-+--++----+++++++-+-+++++--+--+---+-++-+-++-+++-+-+++--+--++-+---+-+----+++++-+++\|||  ||  ||||   |  || | |  | | | | |||| | | ||| ||
|| ||||   ||| |  | |  ||    ||||||| | \++++--+--+---+-++-+-++-+++-+-+++--+--++-+---+-+----+++++-++++++/  ||  ||||   |  || | |  | | | | |||| | | ||| ||
|| ||||   ||| |  | |  ||    |||||\+-+--++++--+--+---+-/| | |v ||| | |||  |  || |   | |    ||||| ||||||   ||  ||||   |  || | |  | | | | |||| | | ||| ||
|| ||||   ||| |  | |  \+----+++++-+-+--++++--+--+---/  | | || ||| | |||  |  || |   | |    ||||| ||||||   ||  ||||   |  || | |  | | | | |||| | | ||| ||
|| ||||   ||| |  | |   |    ||||| | |  |\++--+--+------+-+-++-+++-+-+++--+--++-+---+-+----+++++-++++++---++--+/||   |  || | |  | | | | |||| | | ||| ||
|| ||||   ||| |  | |   |    ||||\-+-+--+-++--+--+------+-+-++-+++-+-+++--+--++-+---+-+----++/|| ||||||   ||  | ||   |  || | |  | | | | |||| | | ||| ||
|| ||||   ||| |  | |   |    |\++--+-+--+-++--+--+------+-+-++-+++-+-+++--+--++-+---+-+----++-++-++++++---++--+-++---+--++-/ |  | | | | |||| | | ||| ||
|| ||||   ||| |  | |   |    | ||  | |  | ||  |  |      | | || ||| | |||  |  || |   | |    || || ||||||   ||  | ||   |  ||   |  | | | | |||| | | ||| ||
|| ||||   ||| |  | |   \----+-++--+-+--+-++--+--+------+-+-++-/|| | |||  |/-++-+---+-+----++-++-++++++---++--+-++---+--++---+--+-+-+\| |||| | | ||| ||
|| ||||   ||| |  | |        | ||  | |  | ||  |  |      | | ||  || | |||  || || |   | |    || || ||||||   ||  | ||   |  ||   |  \-+-+++-++/| | | ||| ||
|| ||||   ||| |  | |        | ||  | |  | ||  \--+------+-+-++--++-+-+++--++-++-+---+-+----++-++-++++++---++--+-++---+--+/   |    | ||| || | | | ||| ||
|| |||\---+++-+--+-+--------+-++--+-+--+-++-----+------+-+-++--++-+-+++--++-++-+---+-+----++-++-++++/|   ||  | |\---+--+----/    | ||| || | | | ||| ||
|| |||    ||| |  | |        | ||  | |  | ||     |      | | ||  || | ||| /++-++-+---+\|    || || |||| |   ||  \-+----+--+------>--+-+++-++-+-/ | ||| ||
|| |||    ||| \--+-+--------+-++--+-+--+-++-----+------+-+-++--++-+-+++-+++-++-+---/||    || || |||| |   \+----+----+--+---------+-+++-++-+---+-+/| ||
|| |||    |||    | |        | ||  | |  | ||     |      | | ||  || | ||| ||| || |    ||    || || |||| |    |    |    |  |         | ||| || |   | | | ||
|| |\+----+++----+-+--------+-+/  | |  | ||  /--+------+-+-++--++-+-+++-+++-++-+---\||    || || |||| |    |    |    |  |         | ||| || |   | | | ||
|| | |    |||    | |        | |   | |  | ||  |  |      | | |\--++-+-+++-+++-++-+---+++----++-/| |||| |    |    |    |  |         | ||| || |   | | | ||
|| | |    |||    | |   /----+-+---+-+--+-++-\|  |      | | |   || | ||| ||| || |   |||    ||  | |||| |    |    |    \--+---------+-+++-++-+---+-+-+-/|
|| | |    ||| /--+-+---+----+-+---+-+-\| || ||  |      | | |   |\-+-+++-+++-/| |   |||    ||  | |||| |    \----+-------+---------+-+++-++-+---+-+-+--/
|| | |    ||| |  | |   |    | |   | | || || ||  |      | | |   |  | ||| |||  | |   |||    ||  | |||| |         |       \---------+-+++-/| |   | | |
|| | |  /-+++-+--+-+---+----+-+---+-+-++-++-++--+------+-+-+---+--+-+++-+++--+-+---+++---\||  | |||| |         |                 | |||  | |   | | |
|| | |  | ||| |  | |   |    | |   | | || || ||  |      | | |   |  \-+++-+++--+-+---+++---+++--+-++++-+---------/                 | |||  | |   | | |
|| | |  | ||| |  | |   |    | |   | | || || ||  |      | | |   |    ||| |||  \-+---+++---+++--+-++++-+---------------------------+-+++--+-+---+-/ |
|| | |  | |\+-+--+-+---+----+-+---+-+-+/ || ||  |      | | |   |    ||| |||    |   |||   |\+--+-++++-+---------------------------+-+++--+-+---+---/
|| | |  | | | |  | |   |    | |   | | |  || ||  |      | | |   |    ||| |||    \---+++---+-+--+-++++-+---------------------------+-/||  | |   |
|| | |  | | | |  | |   |    | |   | | |  |v |\--+------+-+-+---+----+++-+++--------/||   | |  \-++++-+---------------------------+--+/  | |   |
\+-+-+--+-+-+-+--+-+---+----+-+---+-+-+--++-+---+------+-+-+---+----+++-+++---------++---+-+----/||| |                           |  |   | |   |
 | | |  | | | |  | |   |    | |   | | |  || |   |      | | |   |    \++-+++---------++---+-+-----+++-+---------------------------/  |   | |   |
 | | |  | | | |  | |   \----+-+---+-+-+--++-/   |      | | |   |     || |||         ||   | |     \++-+------------------------------+---+-/   |
 | | |  | | | |  \-+--------+-+---+-+-+--+/     |      | | |   |     || |||         ||   | |      || |                              |   |     |
 | | |  | | | |    |        | |   | | |  |      |      | | |   |     || |||         ||   | |      \+-+------------------------------+---+-----/
 | | |  | | \-+----+--------/ |   \-+-+--+------/ /----+-+-+---+-----++-+++---------++---+-+-------+-+-\                            |   |
 | | |  | |   |    |          |     | |  \--------+----+-+-+---/     || |||         ||   | |       | | |                            |   |
 | \-+--+-+---+----+----------+-----+-+-----------+----+-+-/         || |||         ||   | |       | | |                            |   |
 |   |  | |   |    |          |     \-+-----------+----+-/           || \++---------/|   | |       | | |                            |   |
 |   |  | |   |    |          \-------+-----------+----+-------------++--++----------/   | |       | | |                            |   |
 |   |  | |   |    \------------------+>----------+----+-------------++--++----------->--+-+-------+-/ |                            |   |
 |   |  | \---+-----------------------+-----------+----/             ||  \+--------------+-/       |   |                            |   |
 |   |  \-----+-----------------------+-----------+------------------++---+--------------/         |   |                            |   |
 |   |        \-----------------------/           |                  ||   \------------------------+---+----------------------------/   |
 |   \--------------------------------------------+------------------++----------------------------/   |                                |
 |                                                |                  \+------------------------------>-+--------------------------------/
 \------------------------------------------------+-------------------/                                |
                                                  \----------------------------------------------------/
""".trim('\n')

    data class Cart(var pos: Pos, var dir: Dir, var turnDir: Int = 0)

    val lines = input.lines().toList().toMutableList()
    val occupied = array2d<Cart?>(lines.size, lines.maxBy { it.length }!!.length) { null }

    val charToDir = mapOf(
            'v' to Dir.DOWN,
            '^' to Dir.UP,
            '>' to Dir.RIGHT,
            '<' to Dir.LEFT)

    val carts = lines.mapIndexed { y, line -> line.mapIndexedNotNull { x, c ->
        charToDir.mapIfPresent(c) { dir -> Cart(Pos(x,y), dir) }
    } }.flatten().toMutableList()

    for (cart in carts)
        occupied[cart.pos] = cart

    var part1: Pos? = null
    while (carts.size > 1) {
        for (cart in carts.sortedBy { it.pos }) {
            if (!carts.contains(cart))
                continue
            occupied[cart.pos] = null
            cart.pos += cart.dir
            if (occupied[cart.pos] != null) { //crash
                if (part1 == null) {
                    part1 = cart.pos
                }

                carts.remove(cart)
                carts.remove(occupied[cart.pos])
                occupied[cart.pos] = null
            }
            else
               occupied[cart.pos] = cart

            val c = lines[cart.pos]
            if (c == '/' || c == '\\') {
                val horizontal = cart.dir == Dir.LEFT || cart.dir == Dir.RIGHT
                if (horizontal xor (c == '/'))
                    cart.dir = cart.dir.turnRight
                else
                    cart.dir = cart.dir.turnLeft
            }
            else if (c == '+') {
                when (cart.turnDir) {
                    0 -> cart.dir = cart.dir.turnLeft
                    2 -> cart.dir = cart.dir.turnRight
                }
                cart.turnDir = (cart.turnDir + 1) % 3
            }
        }
    }

    val part2 = carts[0].pos.run { "$x,$y" }
    println(part1!!.run { "$x,$y" })
    println(part2)
}
